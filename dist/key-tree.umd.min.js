(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.KeyTree=b()})(this,function(){'use strict';class a{constructor(a,b,c){this.key=b||'',this.values=[],this.children=[],this.parent=a,this.appendValues(c)}removeAllChildren(){this.children=[]}clearValues(){this.values=[]}getChild(a){for(const b of this.children)if(a===b.key)return a;return null}ensureChild(b){let c=this.getChild(b);return c||(c=new a(this,b),this.children.push(c)),c}addChild(b,c){let d=this.getChild(b);return d?d.appendValues(c):(d=new a(this,b,c),this.children.push(d)),d}appendValues(a){if('undefined'!=typeof a){const b=Array.isArray(a)?a:[a];this.values=this.values.concat(b)}}}return class{constructor(b,c){if(this.sep=b&&b.separator||'.',this.$=new a,c)for(const a in c)this.add(a,c[a])}add(a,b){let c=this.$;if(''===a)return void c.appendValues(b);let d=(a||'').trim().split(this.sep);for(let e=0;e<d.length;e++)c=e<d.length-1?c.addChild(d[e],b):c.ensureChild(d[e])}_getNode(a){let b=this.$;if(''!==a){let c=(a||'').trim().split(this.sep);for(let a=0;a<c.length&&!!b;a++)b=b.getChild(c[a])}return b}get(a){let b=this._getNode(a);return b?b.values:[]}getSub(a,b){let c={grouped:{},ungrouped:[]};return this._subChildren(a,this._getNode(a),c),b?c.grouped:c.ungrouped}_subChildren(a,b,d){if(b){d.grouped[a]=b.values,d.ungrouped=d.ungrouped.concat(b.values);for(const e of b.children){let b=`${a}${this.sep}${e.key}`;this._subChildren(b,e,d)}}}}});